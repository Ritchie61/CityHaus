<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CityHaus - Find Your Stay in PNG</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background: #f3f4f6;
            overflow-x: hidden;
        }
        
        .mobile-container {
            max-width: 480px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            position: relative;
            box-shadow: 0 0 40px rgba(0,0,0,0.1);
        }
        
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        .slide-up {
            animation: slideUp 0.3s ease-out;
        }
        
        @keyframes slideUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .scale-in {
            animation: scaleIn 0.2s ease-out;
        }
        
        @keyframes scaleIn {
            from { transform: scale(0.95); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 480px;
            background: white;
            border-top: 1px solid #e5e7eb;
            z-index: 50;
            padding-bottom: env(safe-area-inset-bottom);
        }
        
        .listing-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .listing-card:active {
            transform: scale(0.98);
        }
        
        .chip {
            transition: all 0.2s;
        }
        
        .chip.active {
            background: #059669;
            color: white;
        }
        
        .image-upload-area {
            border: 2px dashed #d1d5db;
            transition: all 0.3s;
        }
        
        .image-upload-area.dragover {
            border-color: #059669;
            background: #ecfdf5;
        }
        
        .modal-overlay {
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(4px);
        }
        
        .bg-png-green { background-color: #059669; }
        .text-png-green { color: #059669; }
        .border-png-green { border-color: #059669; }
        
        .safe-area-top {
            padding-top: env(safe-area-inset-top);
        }
        
        .content-pb {
            padding-bottom: 100px;
        }

        .host-stat-card {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
        }

        .status-badge {
            @apply px-2 py-1 rounded-full text-xs font-medium;
        }
        
        .status-active { @apply bg-green-100 text-green-700; }
        .status-pending { @apply bg-yellow-100 text-yellow-700; }
        .status-inactive { @apply bg-gray-100 text-gray-600; }
    </style>
</head>
<body>
    <div id="app" class="mobile-container">
        <!-- Content injected by JavaScript -->
    </div>

    <script>
        // Data Store
        const store = {
            currentUser: "John Doe",
            userRole: 'guest', // 'guest' or 'host'
            listings: [
                {
                    id: 1,
                    title: "Modern Apartment in Port Moresby",
                    type: "Apartment",
                    price: 350,
                    location: "Waigani, Port Moresby",
                    image: "https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?w=800&auto=format&fit=crop",
                    host: "John Doe",
                    phone: "+675 7123 4567",
                    whatsapp: "+67571234567",
                    rating: 4.8,
                    reviews: 12,
                    amenities: ["WiFi", "AC", "Kitchen", "Parking"],
                    description: "Beautiful modern apartment in the heart of Waigani. Perfect for business travelers or tourists.",
                    beds: 2,
                    baths: 1,
                    guests: 4,
                    available: true,
                    status: 'active',
                    views: 124,
                    inquiries: 8,
                    bookings: 3,
                    earnings: 1050
                },
                {
                    id: 2,
                    title: "Traditional Lodge - Goroka",
                    type: "Lodge",
                    price: 180,
                    location: "Goroka, Eastern Highlands",
                    image: "https://images.unsplash.com/photo-1587061949409-02df41d5e562?w=800&auto=format&fit=crop",
                    host: "John Doe",
                    phone: "+675 7234 5678",
                    whatsapp: "+67572345678",
                    rating: 4.9,
                    reviews: 8,
                    amenities: ["Garden", "Traditional Meals", "Mountain View"],
                    description: "Experience authentic Highland culture in our traditional lodge.",
                    beds: 3,
                    baths: 2,
                    guests: 6,
                    available: true,
                    status: 'active',
                    views: 89,
                    inquiries: 5,
                    bookings: 2,
                    earnings: 360
                }
            ],
            myListings: [],
            filters: {
                type: 'All',
                maxPrice: 1000,
                location: ''
            },
            currentScreen: 'home',
            selectedListing: null,
            editingListing: null
        };

        // Initialize myListings with John Doe's listings
        store.myListings = store.listings.filter(l => l.host === store.currentUser);

        // Utility Functions
        const formatPrice = (price) => `K${price}/night`;
        const formatNumber = (num) => num.toLocaleString();
        
        const getAmenityIcon = (amenity) => {
            const icons = {
                'WiFi': 'fa-wifi', 'AC': 'fa-snowflake', 'Kitchen': 'fa-utensils',
                'Parking': 'fa-car', 'Garden': 'fa-tree', 'Pool': 'fa-swimming-pool',
                'Beach Access': 'fa-umbrella-beach', 'BBQ': 'fa-fire',
                'Kayak': 'fa-ship', 'Fan': 'fa-fan', 'Security': 'fa-shield-alt',
                'Restaurant': 'fa-utensils', 'Bar': 'fa-glass-cheers',
                'Laundry': 'fa-tshirt', 'Mountain View': 'fa-mountain',
                'Traditional Meals': 'fa-drumstick-bite'
            };
            return icons[amenity] || 'fa-check';
        };

        const getTypeIcon = (type) => {
            const icons = {
                'Home': 'fa-home', 'Apartment': 'fa-building',
                'Lodge': 'fa-campground', 'Inn': 'fa-bed', 'Other': 'fa-house-user'
            };
            return icons[type] || 'fa-home';
        };

        // Components
        const Components = {
            BottomNav: () => {
                const isGuest = store.userRole === 'guest';
                const items = isGuest ? [
                    { id: 'home', icon: 'fa-search', label: 'Browse' },
                    { id: 'saved', icon: 'fa-heart', label: 'Saved' },
                    { id: 'trips', icon: 'fa-suitcase', label: 'Trips' },
                    { id: 'profile', icon: 'fa-user', label: 'Profile' }
                ] : [
                    { id: 'hostDashboard', icon: 'fa-chart-pie', label: 'Dashboard' },
                    { id: 'myListings', icon: 'fa-list', label: 'My Listings' },
                    { id: 'add', icon: 'fa-plus-circle', label: 'Add New' },
                    { id: 'profile', icon: 'fa-user', label: 'Profile' }
                ];

                return `
                    <nav class="bottom-nav flex justify-around items-center py-3 px-4">
                        ${items.map(item => `
                            <button onclick="navigateTo('${item.id}')" 
                                    class="flex flex-col items-center gap-1 ${store.currentScreen === item.id ? 'text-emerald-600' : 'text-gray-400'} transition-colors">
                                <i class="fas ${item.icon} text-xl"></i>
                                <span class="text-xs font-medium">${item.label}</span>
                            </button>
                        `).join('')}
                    </nav>
                `;
            },

            Header: (title, showBack = false, rightAction = null) => `
                <header class="sticky top-0 z-40 bg-white border-b border-gray-100 safe-area-top">
                    <div class="flex items-center justify-between px-4 py-4">
                        ${showBack ? `
                            <button onclick="goBack()" class="p-2 -ml-2 text-gray-600 hover:text-emerald-600 transition-colors">
                                <i class="fas fa-arrow-left text-xl"></i>
                            </button>
                        ` : '<div class="w-10"></div>'}
                        
                        <h1 class="text-lg font-bold text-gray-800">${title}</h1>
                        
                        ${rightAction ? rightAction : '<div class="w-10"></div>'}
                    </div>
                </header>
            `,

            ListingCard: (listing, isHostView = false) => `
                <div class="listing-card bg-white rounded-2xl overflow-hidden shadow-sm border border-gray-100 mb-4" 
                     onclick="${isHostView ? `editListing(${listing.id})` : `viewListing(${listing.id})`}">
                    <div class="relative h-48 overflow-hidden">
                        <img src="${listing.image}" alt="${listing.title}" class="w-full h-full object-cover">
                        <div class="absolute top-3 right-3 bg-white/90 backdrop-blur-sm px-2 py-1 rounded-lg text-xs font-semibold text-gray-700">
                            <i class="fas ${getTypeIcon(listing.type)} mr-1"></i>
                            ${listing.type}
                        </div>
                        ${isHostView ? `
                            <div class="absolute top-3 left-3">
                                <span class="status-badge status-${listing.status} capitalize">${listing.status}</span>
                            </div>
                        ` : `
                            <button onclick="event.stopPropagation(); toggleSave(${listing.id})" class="absolute top-3 left-3 w-8 h-8 bg-white/90 backdrop-blur-sm rounded-full flex items-center justify-center text-gray-400 hover:text-red-500 transition-colors">
                                <i class="far fa-heart"></i>
                            </button>
                        `}
                    </div>
                    <div class="p-4">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="font-semibold text-gray-800 line-clamp-1 flex-1 mr-2">${listing.title}</h3>
                            <div class="flex items-center gap-1 text-sm">
                                <i class="fas fa-star text-yellow-400"></i>
                                <span class="font-medium">${listing.rating || 'New'}</span>
                            </div>
                        </div>
                        <p class="text-gray-500 text-sm mb-3 flex items-center">
                            <i class="fas fa-map-marker-alt mr-1 text-gray-400"></i>
                            ${listing.location}
                        </p>
                        <div class="flex items-center justify-between">
                            <div>
                                <span class="text-lg font-bold text-emerald-600">${formatPrice(listing.price)}</span>
                            </div>
                            ${isHostView ? `
                                <div class="flex gap-3 text-sm text-gray-500">
                                    <span class="flex items-center gap-1" title="Views">
                                        <i class="fas fa-eye text-emerald-500"></i> ${listing.views || 0}
                                    </span>
                                    <span class="flex items-center gap-1" title="Bookings">
                                        <i class="fas fa-calendar-check text-emerald-500"></i> ${listing.bookings || 0}
                                    </span>
                                </div>
                            ` : `
                                <div class="flex gap-2 text-gray-400 text-sm">
                                    <span class="flex items-center gap-1">
                                        <i class="fas fa-user-friends"></i> ${listing.guests}
                                    </span>
                                    <span class="flex items-center gap-1">
                                        <i class="fas fa-bed"></i> ${listing.beds}
                                    </span>
                                </div>
                            `}
                        </div>
                    </div>
                </div>
            `,

            FilterChip: (label, active, onClick) => `
                <button onclick="${onClick}" 
                        class="chip px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap ${active ? 'active' : 'bg-gray-100 text-gray-600 hover:bg-gray-200'}">
                    ${label}
                </button>
            `,

            AmenityTag: (amenity) => `
                <span class="inline-flex items-center gap-1 px-3 py-1.5 bg-gray-50 rounded-lg text-sm text-gray-600 border border-gray-100">
                    <i class="fas ${getAmenityIcon(amenity)} text-emerald-600"></i>
                    ${amenity}
                </span>
            `
        };

        // Screen Renderers
        const Screens = {
            home: () => {
                const filteredListings = store.listings.filter(l => {
                    if (store.filters.type !== 'All' && l.type !== store.filters.type) return false;
                    if (l.price > store.filters.maxPrice) return false;
                    if (store.filters.location && !l.location.toLowerCase().includes(store.filters.location.toLowerCase())) return false;
                    return true;
                });

                const types = ['All', 'Home', 'Apartment', 'Lodge', 'Inn', 'Other'];

                return `
                    ${Components.Header('CityHaus', false, `
                        <button onclick="toggleRole()" class="text-xs bg-emerald-100 text-emerald-700 px-3 py-1.5 rounded-full font-medium">
                            ${store.userRole === 'guest' ? 'Guest' : 'Host'}
                        </button>
                    `)}
                    
                    <div class="px-4 py-4 content-pb">
                        <div class="relative mb-4">
                            <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                            <input type="text" 
                                   placeholder="Where in PNG?" 
                                   class="w-full pl-11 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:bg-white transition-all"
                                   oninput="store.filters.location = this.value; render();">
                        </div>

                        <div class="flex gap-2 overflow-x-auto hide-scrollbar mb-6 pb-2">
                            ${types.map(type => Components.FilterChip(
                                type === 'All' ? 'All Types' : `<i class="fas ${getTypeIcon(type)} mr-1"></i>${type}`, 
                                store.filters.type === type,
                                `setFilter('type', '${type}')`
                            )).join('')}
                        </div>

                        <div class="mb-6">
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-sm font-medium text-gray-700">Max Price: K${store.filters.maxPrice}</span>
                            </div>
                            <input type="range" min="100" max="1000" step="50" value="${store.filters.maxPrice}"
                                   class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-emerald-600"
                                   oninput="store.filters.maxPrice = parseInt(this.value); render();">
                        </div>

                        <div class="space-y-4">
                            ${filteredListings.length === 0 ? `
                                <div class="text-center py-12 text-gray-400">
                                    <i class="fas fa-search text-4xl mb-3"></i>
                                    <p>No listings found</p>
                                </div>
                            ` : filteredListings.map(listing => Components.ListingCard(listing)).join('')}
                        </div>
                    </div>
                    
                    ${Components.BottomNav()}
                `;
            },

            // NEW HOST DASHBOARD
            hostDashboard: () => {
                const totalEarnings = store.myListings.reduce((sum, l) => sum + (l.earnings || 0), 0);
                const totalViews = store.myListings.reduce((sum, l) => sum + (l.views || 0), 0);
                const totalBookings = store.myListings.reduce((sum, l) => sum + (l.bookings || 0), 0);
                const activeListings = store.myListings.filter(l => l.status === 'active').length;

                return `
                    ${Components.Header('Host Dashboard', false, `
                        <button onclick="navigateTo('add')" class="w-10 h-10 bg-emerald-100 rounded-full flex items-center justify-center text-emerald-600 hover:bg-emerald-200 transition-colors">
                            <i class="fas fa-plus"></i>
                        </button>
                    `)}
                    
                    <div class="content-pb px-4 py-6 space-y-6">
                        <!-- Welcome -->
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-500 text-sm">Welcome back,</p>
                                <h2 class="text-2xl font-bold text-gray-800">${store.currentUser}</h2>
                            </div>
                            <div class="w-12 h-12 bg-emerald-100 rounded-full flex items-center justify-center text-emerald-700 font-bold text-xl">
                                ${store.currentUser.charAt(0)}
                            </div>
                        </div>

                        <!-- Stats Grid -->
                        <div class="grid grid-cols-2 gap-4">
                            <div class="host-stat-card rounded-2xl p-4 text-white">
                                <div class="flex items-center justify-between mb-2">
                                    <i class="fas fa-wallet text-white/70 text-xl"></i>
  
